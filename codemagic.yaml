workflows:
  android-workflow:
    name: Android Build
    max_build_duration: 120
    instance_type: mac_mini_m1
    environment:
      android:
        build_tools: 34.0.0
        ndk: r23c
      java: 17
      groups:
        - android_signing
      vars:
        GRADLE_TASK: ":app:assembleRelease"
        ANDROID_KEYSTORE_PATH: "/tmp/keystore.keystore"
        ANDROID_KEYSTORE_PASSWORD: "your_keystore_password"
        ANDROID_KEY_ALIAS: "your_key_alias"
        ANDROID_KEY_PASSWORD: "your_key_password"
    scripts:
      - name: Install dependencies
        script: |
          ./gradlew dependencies
      - name: Generate Room Schema
        script: |
          ./gradlew :app:kspDebugKotlin
      - name: Build Android
        script: |
          ./gradlew $GRADLE_TASK
    artifacts:
      - app/build/outputs/**/*.apk
      - app/schemas/**/1.json
    publishing:
      email:
        recipients:
          - mafi82290@online.de
        notify:
          success: true
          failure: true
